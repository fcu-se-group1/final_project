{% extends "base.html" %}

{% block title %}Career test{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<div class="container d-flex justify-content-center align-items-center" style="height: 80%;">

    <div class="col-12 col-lg-6">
        <div class="card border-purple rounded-4 h-100">
            <div class="card-header p-3 px-4 d-flex justify-content-between align-items-center">
                <h2 class="fw-bold mb-0" id="questionTitle">第 1 題</h2>
                <button class="btn btn-indigo" id="saveButon" onclick="finishTest()">完成</button>
                <div class="progress" style="width: 50%;" id="progressContainer">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar" style="width: 0%;"></div>
                </div>
            </div>
            
            <div class="card-body text-purple d-flex flex-column justify-content-center align-items-center p-2 py-4" style="gap: 1rem;">
                <div class="col-12 d-flex justify-content-center align-items-center">
                    <h3 id="questionText" class="fw-bold mb-0">我經常被獨特的音樂旋律或視覺藝術所吸引</h3>
                </div>
                <div class="col-6 d-flex justify-content-center align-items-center" id="agreementRow">
                    <h5 class="col-4 fw-bold mb-0 d-flex justify-content-center">同意</h5>
                    <span class="col-4 mx-3 d-flex justify-content-center">&lt; --- &gt;</span>
                    <h5 class="col-4 fw-bold mb-0 d-flex justify-content-center">不同意</h5>
                </div>
                <div class="col-12 d-flex justify-content-center align-items-center" id="rangeRow">
                    <input type="range" class="form-range" id="answerRange" min="1" max="5" step="1">
                </div>
                <div class="col-12 d-flex justify-content-center align-items-center" id="answerContainer">
                </div>
            </div>

            <div class="card-footer px-4 d-flex justify-content-center" style="gap: 2rem;">
                <button class="btn btn-indigo" id="prevButton" onclick="prevQuestion()" hidden>上一題</button>
                <button class="btn btn-indigo" id="nextButton" onclick="nextQuestion()">下一題</button>
            </div>

        </div>
    </div>

</div>
{% endblock %}

{% block content1 %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
    const user_id = localStorage.getItem('user_id');
    const lastpage = localStorage.getItem('savepage');
    const types = ['A', 'C', 'E', 'I', 'R', 'S'];
    let questions = [];
    let currentQuestionIndex = 0;
    let currentSaveQuestionIndex = [];

    async function loadQuestions() {
        for (const type of types) {
            const response = await fetch(`/show_career_test/${type}`);
            const data = await response.json();
            questions = questions.concat(data['選擇題'].map(q => ({ type: '選擇題', text: q })));
        }
    }

    function updateQuestion() {
        const question = questions[currentQuestionIndex];
        document.getElementById('questionTitle').textContent = `第 ${currentQuestionIndex + 1} 題`;
        document.getElementById('questionText').textContent = question.text;
        const answerContainer = document.getElementById('answerContainer');
        answerContainer.innerHTML = '';

        const rangeInput = document.getElementById('answerRange');
        rangeInput.value = 3; // 默認值為中立
    }

    function saveAnswer() {
        const rangeInput = document.getElementById('answerRange');
        if (currentSaveQuestionIndex.includes(currentQuestionIndex)) {
            document.getElementById('progressBar').style.width = `${(currentSaveQuestionIndex.length/questions.length)*100}%`;
        }
        else {
            currentSaveQuestionIndex.push(currentQuestionIndex);
            document.getElementById('progressBar').style.width = `${(currentSaveQuestionIndex.length/questions.length)*100}%`;
        }
        // 保存答案的邏輯
        console.log(`Question ${currentQuestionIndex + 1}: ${rangeInput.value}`);
    }

    function nextQuestion() {
        saveAnswer();
        if (currentQuestionIndex < questions.length - 2) {
            currentQuestionIndex++;
            updateQuestion();
            document.getElementById('prevButton').hidden = false;
            document.getElementById('nextButton').hidden = false;
        }
        else if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            updateQuestion();
            document.getElementById('prevButton').hidden = false;
            document.getElementById('nextButton').hidden = true;
        }
    }

    function prevQuestion() {
        saveAnswer();
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            updateQuestion();
            document.getElementById('nextButton').textContent = '下一題';
            if (currentQuestionIndex === 0) {
                document.getElementById('prevButton').hidden = true;
            }
        }
    }

    function finishTest() {
        if (document.getElementById('progressBar').style.width === '100%') {
            Swal.fire({
                title: '測驗完成',
                text: '您已完成所有題目',
                icon: 'success',
                confirmButtonText: '確定'
            }).then(() => {
                // 提交測驗結果的邏輯
                console.log('測驗完成');
            });
        }
        else {
            Swal.fire({
                title: '測驗未完成',
                text: '請完整填寫問卷',
                icon: 'error',
                confirmButtonText: '確定'
            });
        }
    }
    loadQuestions();
</script>
{% endblock %}