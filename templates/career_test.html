{% extends "base.html" %}

{% block title %}Career test{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="height: 80%;">

    <div class="col-12 col-lg-6">
        <div class="card border-purple rounded-4 h-100">
            <div class="card-header p-3 px-4 d-flex justify-content-between align-items-center">
                <h2 class="fw-bold mb-0" id="questionTitle">職涯測驗</h2>
                <div class="progress" style="width: 50%;" id="progressContainer" hidden>
                    <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar" style="width: 0%;"></div>
                </div>
            </div>
            
            <div class="card-body text-purple d-flex flex-column justify-content-center align-items-center p-2 py-4" style="gap: 1rem;">
                <div class="col-12 d-flex justify-content-center align-items-center">
                    <h3 id="questionText" class="fw-bold mb-0">點擊按鈕即可進行測驗</h3>
                </div>
                <div class="col-6 d-none justify-content-center align-items-center" id="agreementRow">
                    <h5 class="col-4 fw-bold mb-0 d-flex justify-content-center">同意</h5>
                    <span class="col-4 mx-3 d-flex justify-content-center">&lt;---&gt;</span>
                    <h5 class="col-4 fw-bold mb-0 d-flex justify-content-center">不同意</h5>
                </div>
                <div class="col-12 d-none justify-content-center align-items-center" id="rangeRow">
                    <input type="range" class="form-range" id="answerRange" min="1" max="5" step="1">
                </div>
            </div>

            <div class="card-footer px-4 d-flex justify-content-center" style="gap: 2rem;">
                <button class="btn btn-indigo" id="prevButton" onclick="prevQuestion()" hidden>上一題</button>
                <a href="{{ url_for('chooseFunction') }}" class="btn btn-indigo" id="backButton">返回前頁</a>
                <button class="btn btn-indigo" id="nextButton" onclick="checkLogin()">開始測驗</button>
            </div>

        </div>
    </div>

</div>
{% endblock %}

{% block content1 %}
<script>
    const questions = [
        "你喜歡與人合作嗎？",
        "你喜歡解決複雜的問題嗎？",
        "你喜歡學習新技術嗎？",
        "你喜歡幫助他人嗎？",
        "你喜歡挑戰自我嗎？"
    ]; // 假資料

    let currentQuestionIndex = 0;
    const totalQuestions = questions.length;
    const answers = Array(totalQuestions).fill(null);

    function updateQuestion() {
        document.getElementById('questionTitle').textContent = `第 ${currentQuestionIndex + 1} 題`;
        document.getElementById('questionText').textContent = questions[currentQuestionIndex];
        document.getElementById('progressBar').style.width = `${((currentQuestionIndex + 1) / totalQuestions) * 100}%`;
        document.getElementById('answerRange').value = answers[currentQuestionIndex] || 3;
        document.getElementById('prevButton').hidden = currentQuestionIndex === 0;
        document.getElementById('nextButton').textContent = currentQuestionIndex === totalQuestions - 1 ? '填寫完成' : '下一題';
    }

    function checkLogin() {
        const user_id = localStorage.getItem('SID');
        if (!user_id) {
            Swal.fire({
                title: '無法進行測驗',
                text: '您尚未登入',
                icon: 'error',
                confirmButtonText: '確定',
                scrollbarPadding: false
            });
        } else {
            startTest();
        }
    }

    function startTest() {
        document.getElementById('questionTitle').textContent = `第 1 題`;
        document.getElementById('questionText').textContent = questions[0];
        document.getElementById('progressContainer').hidden = false;
        document.getElementById('agreementRow').className = 'col-6 d-flex justify-content-center align-items-center';
        document.getElementById('rangeRow').className = 'col-12 d-flex justify-content-center align-items-center';
        document.getElementById('prevButton').hidden = true;
        document.getElementById('nextButton').textContent = '下一題';
        document.getElementById('nextButton').onclick = nextQuestion;
        document.getElementById('backButton').hidden = true;
        updateQuestion();
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            answers[currentQuestionIndex] = document.getElementById('answerRange').value;
            currentQuestionIndex--;
            updateQuestion();
        }
    }

    function nextQuestion() {
        answers[currentQuestionIndex] = document.getElementById('answerRange').value;
        if (currentQuestionIndex < totalQuestions - 1) {
            currentQuestionIndex++;
            updateQuestion();
        } else {
            if (answers.includes(null)) {
                Swal.fire({
                    title: '測驗未完成',
                    text: '請完整填寫問卷',
                    icon: 'error',
                    confirmButtonText: '確定',
                    scrollbarPadding: false
                });
            } else {
                Swal.fire({
                    title: '測驗完成',
                    text: '感謝您的填寫',
                    icon: 'success',
                    confirmButtonText: '確定',
                    scrollbarPadding: false
                }).then(() => {
                    window.location.href = "{{ url_for('career_test_result') }}";
                });
            }
        }
    }
</script>
{% endblock %}